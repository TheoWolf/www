<nav class="col_nav page_sidebar">
	{% for pg in PAGES if pg.slug == page.slug.split('/')[0] %}
		<h2>
            <a href="{{ SITEURL }}/{{ pg.url }}" class="{% if page.slug == pg.slug %}current{% endif %}">{{ pg.title|replace('&nbsp;', ' ') }}</a>
		</h2>
	{% endfor %}

	{# This recursive hack is awful, but jinja recursive feature is incompatible with pelican's page structure. #}

	{% for pg1 in PAGES|sort(attribute='order') if pg1.slug.startswith(page.slug.split('/')[0]) and pg1.slug.count('/') == 1 %}
		{% if loop.first %}
			<ul>
		{% endif %}

				<li>
                    <a href="{{ SITEURL }}/{{ pg1.url }}" class="{% if page.slug == pg1.slug %}current{% else %}{% if pg1.slug in page.slug %}parent{% endif %}{% endif %}">{{ pg1.title|replace('&nbsp;', ' ') }}</a>

					{% for pg2 in PAGES|sort(attribute='order') if pg2.slug.startswith('/'.join(pg1.slug.split('/')[0:2])) and pg2.slug.count('/') == 2 %}
						{% if loop.first %}
							<ul>
						{% endif %}

								<li>
                                    <a href="{{ SITEURL }}/{{ pg2.url }}" class="{% if page.slug == pg2.slug %}current{% else %}{% if pg2.slug in page.slug %}parent{% endif %}{% endif %}">{{ pg2.title|replace('&nbsp;', ' ') }}</a>

									{% for pg3 in PAGES|sort(attribute='order') if pg3.slug.startswith('/'.join(pg2.slug.split('/')[0:3])) and pg3.slug.count('/') == 3 %}
										{% if loop.first %}
											<ul>
										{% endif %}

												<li>
                                                    <a href="{{ SITEURL }}/{{ pg3.url }}" class="{% if page.slug == pg3.slug %}current{% else %}{% if pg3.slug in page.slug %}parent{% endif %}{% endif %}">{{ pg3.title|replace('&nbsp;', ' ') }}</a>

                                                    {% for pg4 in PAGES|sort(attribute='order') if pg4.slug.startswith('/'.join(pg3.slug.split('/')[0:4])) and pg4.slug.count('/') == 4 %}
														{% if loop.first %}
															<ul>
														{% endif %}

																<li>
				                                                    <a href="{{ SITEURL }}/{{ pg4.url }}" class="{% if page.slug == pg4.slug %}current{% else %}{% if pg4.slug in page.slug %}parent{% endif %}{% endif %}">{{ pg4.title|replace('&nbsp;', ' ') }}</a>
																</li>
				                                                  
				                                                    {% for pg5 in PAGES|sort(attribute='order') if pg5.slug.startswith('/'.join(pg4.slug.split('/')[0:5])) and pg5.slug.count('/') == 5 %}
																		{% if loop.first %}
																			<ul>
																		{% endif %}

																				<li>
								                                                    <a href="{{ SITEURL }}/{{ pg5.url }}" class="{% if page.slug == pg5.slug %}current{% else %}{% if pg5.slug in page.slug %}parent{% endif %}{% endif %}">{{ pg5.title|replace('&nbsp;', ' ') }}</a>
																				</li>																	
																	
																	{% if loop.last %}
																			</ul>
																		{% endif %}
																	{% endfor %}
																</li>

														{% if loop.last %}
															</ul>
														{% endif %}
													{% endfor %}
												</li>

										{% if loop.last %}
											</ul>
										{% endif %}
									{% endfor %}
								</li>

						{% if loop.last %}
							</ul>
						{% endif %}
					{% endfor %}
				</li>

		{% if loop.last %}
			</ul>
		{% endif %}
	{% endfor %}
</nav>
